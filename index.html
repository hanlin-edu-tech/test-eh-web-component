<!DOCTYPE html>
<html lang="zh-Hant-TW">
    <head>
        <meta charset="UTF-8"/>
        <style>
            :not(:defined) {
                background-color: #AAA;
            }

            body {
                display: flex;
                flex-flow: column;
            }

            eh-header {
                transition: background-color 0.5s;
                display: flex;
                width: 100%;
                height: 50px;
            }


            @media screen and (prefers-color-scheme: dark) {
                body{
                    background-color: #666;
                    color: #ff0;
                }
            }
        </style>
    </head> 
    
    <body>
<!-- 頁面主要結構 >>> -->
        <eh-header></eh-header>

		<eh-profile>
			<img slot="avatar" src="https://ehanlin-web-resource.s3-ap-northeast-1.amazonaws.com/platform/avatar/ps01.png" alt="" />
			<eh-user-info>
				<span slot="item-key">帳號</span>
				<span slot="item-value">bj4@ehanlin.com.tw</span>
			</eh-user-info>
			<eh-user-info>
				<span slot="item-key">名稱</span>
				<span slot="item-value">bj4</span>
			</eh-user-info>
			<eh-user-info>
				<span slot="item-key">年級</span>
				<select id="" name="" slot="item-value">
				        <option value="7" selected>7</option>
				        <option value="8">8</option>
				        <option value="9">8</option>
				</select>
			</eh-user-info>
		</eh-profile>

		<eh-profile id="profile2"></eh-profile>
		<button id="rand">隨機</button>
		<eh-profile id="profile3"></eh-profile>


<!-- <<< 頁面主要結構 -->

<!-- 客制元件注入 >>> -->

		<template id="eh-profile">
			<style>
	            @media screen and (prefers-color-scheme: dark) {
                    :host {
                        background-color: #dedede;
                    }
                }


				@media (min-width: 650px) {
					hr {
						display:none;
					}
					.user-info-list {
						padding-left:10px;
					}

					.avatar::slotted(*) {
						vertical-align:top;
					}
				}

				.break {
				  flex-basis: 100%;
				  height: 0;
				}
			
				:host {
					border: 1px solid gray;
					padding:10px;
					border-radius:6px;
				}

				:host > div{
  					display: flex;
  					flex-wrap: wrap;
				}

			</style>

			<div>
				<slot name="avatar" class="avatar"></slot>
				<hr class="break">
				<div class="user-info-list">
					<slot class="user-info-item"></slot>
				</div>
			</div>

		</template>

        <template id="eh-user-info">
            <style>
                :host {
                    all: initial;
                    border-bottom: 1px #33F solid;
                    display: flex;
                }
                @media (max-width: 600px) {
                    :host {
                        border-bottom: 3px #F33 solid;
                    }
                }
            </style>
            <div>
                <slot name="item-key"></slot> : <slot name="item-value"></slot>
            </div>
        </template>
        <script>
            const defineCustomElement = (id) => {
                customElements.define(id, class extends HTMLElement {
                    constructor() {
                        super();
                        let shadowRoot = this.attachShadow({mode: 'open'});
                        let t = document.querySelector(`#${id}`);
                        let instance = t.content.cloneNode(true);
                        shadowRoot.appendChild(instance);
                    }
                });
            };
            defineCustomElement('eh-profile');

            customElements.define('eh-user-info', class extends HTMLElement {
                constructor(itemKey, itemValue) {
                    super();
                    const shadowRoot = this.attachShadow({mode: 'open'});
                    const t = document.querySelector('#eh-user-info');
                    const instance = t.content.cloneNode(true);
                    if(itemKey){
                        instance.querySelector("slot[name=item-key]").innerHTML = itemKey;
                    }
                    if(itemValue){
                        instance.querySelector("slot[name=item-value]").innerHTML = itemValue;
                    }
                    shadowRoot.appendChild(instance);
                }
            });
        </script>
<!-- <<< 客制元件注入 -->

<!-- 主要程式邏輯 >>> -->
        <script src="dataprovider.js"></script>
        <script>
            //動態產生組合物件的二種方法
            //使用 class 組物件的方法
            const profile2 = document.querySelector('#profile2');
            const UserInfoItem = customElements.get('eh-user-info');

			let profileImage2 = new Image();
			profileImage2.src = 'https://ehanlin-web-resource.s3-ap-northeast-1.amazonaws.com/platform/avatar/ps02.png';
			profileImage2.slot = 'avatar';

			profile2.appendChild(profileImage2);

            for (let item of [['帳號', 'cat@ehanlin.com.tw'], ['名稱', 'cat'], ['年級', '<input readonly value="8" />']]) {
                profile2.appendChild(new UserInfoItem(item[0], item[1]));
            }

            //使用組 string 的方法
            const profile3 = document.querySelector('#profile3');
            EHDataprovider.addEventListener("items-change", () => {
                let profileHtml = `
					<img slot="avatar" src="https://ehanlin-web-resource.s3-ap-northeast-1.amazonaws.com/platform/avatar/${EHDataprovider.view.items.img}" alt="">
				`;
                EHDataprovider.view.items.forEach( item => {
                    // <span id="test" slot="item-key"> 會被 #test 選中
                    profileHtml += `
						<eh-user-info>
                            <span slot="item-key">${item[0]}</span>
                            <span slot="item-value">${item[1]}</span>
						</eh-user-info>`;
                });
                profile3.innerHTML = '';
                profile3.innerHTML = profileHtml;
            });

            EHDataprovider.random();
            const randBtn = document.querySelector('#rand');
            randBtn.addEventListener("click", () => {
                EHDataprovider.random();
            });


        </script>
<!-- <<< 主要程式邏輯 -->

        <script src="eh-header.js"></script>
    </body>
</html>
